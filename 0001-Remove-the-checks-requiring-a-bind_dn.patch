From 295b6d2e744bcb7a1668085e6194a1f4c319dd18 Mon Sep 17 00:00:00 2001
From: John Thiltges <jthiltges2@unl.edu>
Date: Wed, 8 Nov 2023 14:50:43 -0600
Subject: [PATCH 1/2] Remove the checks requiring a bind_dn

The code assumes an Active Directory server. For a non-AD server such as OpenLDAP, it works fine with an anonymous bind.
---
 pkgs/duoauthproxy/duoauthproxy/lib/util.py                   | 5 -----
 .../duoauthproxy/lib/validation/config/check/ad_client.py    | 4 ++--
 2 files changed, 2 insertions(+), 7 deletions(-)

diff --git a/pkgs/duoauthproxy/duoauthproxy/lib/util.py b/pkgs/duoauthproxy/duoauthproxy/lib/util.py
index 71e2853..f4baa34 100644
--- a/pkgs/duoauthproxy/duoauthproxy/lib/util.py
+++ b/pkgs/duoauthproxy/duoauthproxy/lib/util.py
@@ -523,11 +523,6 @@ def parse_ad_client(config):
     else:
         ldap_filter = None
 
-    # A blank bind_dn will be rejected with auth-type plain in validation
-    # otherwise we supply a default
-    if not bind_dn:
-        bind_dn = "<ROOT>"
-
     warning_message = warn_insecure_settings(auth_type, transport_type)
     if warning_message:
         log.msg(warning_message)
diff --git a/pkgs/duoauthproxy/duoauthproxy/lib/validation/config/check/ad_client.py b/pkgs/duoauthproxy/duoauthproxy/lib/validation/config/check/ad_client.py
index b6e1f74..9265349 100644
--- a/pkgs/duoauthproxy/duoauthproxy/lib/validation/config/check/ad_client.py
+++ b/pkgs/duoauthproxy/duoauthproxy/lib/validation/config/check/ad_client.py
@@ -132,7 +132,7 @@ def check_config_values(config, toolbox):
         config, config_test_resolver, dynamic_test_resolver
     )
 
-    problems += check_valid_service_account_username_for_auth_type(config, toolbox)
+    #problems += check_valid_service_account_username_for_auth_type(config, toolbox)
 
     problems += base.run_config_value_checks(config, config_test_resolver)
 
@@ -156,7 +156,7 @@ def check_config_dependencies(config, toolbox):
 
     """
     problems = check_valid_cert_for_transport(config, toolbox)
-    problems += check_valid_bind_dn_for_auth_type(config, toolbox)
+    #problems += check_valid_bind_dn_for_auth_type(config, toolbox)
     problems += check_hostname_verification(config, toolbox)
     return problems
 
-- 
2.41.0

